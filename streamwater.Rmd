---
title: "Streamwater Data"
output:
  html_document:
      code_folding: show
author: Mia Forsline, Desik Somasundaram, Alex Vand
date: 2021-08-25
---

Contact: mforsline@bren.ucsb.edu, asy@bren.ucsb.edu, desik@bren.ucsb.edu


# Background Information & Objective
Stream water data collected weekly from 1988 to 2012 at Luquillo Mountain in Puerto Rico, including data after Hurricane Hugo in September 1989. This data includes potassium concentration (milligrams per liter) and nitrate (micrograms per liter) concentration from four different sites.

Our research focuses on comparing K and NO3 concentrations at the different sites before and after Hurricane Hugo in September 1989.




# Collaborative workflow

Data is stored on our shared server at Bren (Taylor) and our repository is git-controlled on github and enabled us to access through our personal accounts on the Taylor server.

### Initial approach
![Old Workflow.](images/oldworkflow.jpg)


### Final approach
![New Workflow.](images/newworkflow.jpg)


## Git workflow

Alex Vand created the github repository. Desik Somasundaram and Mia Forsline cloned the repo and made changes on their virtual machine account and then pushed changes back to the github repo.


## Pair programming

Our group used the pair programming approach with one driver and two navigators. The navigators searched online to support the driver and also examined the metadata to ensure consistency and accuracy among the different datasets.

## Challenges

One of key challenges was establishing the initial Github workflow among team members.
We had issues regarding push/pull permissions and Personal Access Tokens on the remote server that had to resolved before proceeding with our coding. 

We also had some issues with the remote server lagging which required killing active R sessions and restarting.

The collaborative workflow was a new experience for our team so we had to get acquainted with everyone's pace and learn to speak in technical language that is easy to understand for everyone in the group, especially during pair programming.


# Attach required packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(janitor)
library(ggplot2)
library(patchwork)

```


# Read in the data, identifying unique NA values
```{r}
qc1 <- read_csv("/courses/EDS214/eds214-dammad-coders/data/raw_data/QuebradaCuenca1-Bisley.csv", na = c("-9999", "-9999.00", "-9999.0")) %>% 
  clean_names()

qc2 <- read_csv("/courses/EDS214/eds214-dammad-coders/data/raw_data/QuebradaCuenca2-Bisley.csv", na = c("-9999", "-9999.00", "-9999.0")) %>% 
  clean_names()

qc3 <- read_csv("/courses/EDS214/eds214-dammad-coders/data/raw_data/QuebradaCuenca3-Bisley.csv", na = c("-9999", "-9999.00", "-9999.0")) %>% 
  clean_names()

mpr <- read_csv("/courses/EDS214/eds214-dammad-coders/data/raw_data/RioMameyesPuenteRoto.csv", na = c("-9999", "-9999.00", "-9999.0")) %>% 
  clean_names()
```


# Clean/wrangle the data
- Select variables (columns) of interest
- Converted the date to ISO 8601 format
- Renamed columns to include units
- Combined all four datasets
```{r}
qc1_clean <- qc1 %>% 
  select(sample_id, code, sample_date, k, no3) %>% 
  mutate(sample_date = lubridate::mdy(sample_date)) %>% 
  rename(k_mg_L = k, no3_ug_L = no3)

qc2_clean <- qc2 %>% 
  select(sample_id, code, sample_date, k, no3) %>% 
  mutate(sample_date = lubridate::mdy_hm(sample_date)) %>% 
  rename(k_mg_L = k, no3_ug_L = no3)

qc3_clean <- qc3 %>% 
  select(sample_id, code, sample_date, k, no3) %>% 
  mutate(sample_date = lubridate::mdy(sample_date)) %>% 
  rename(k_mg_L = k, no3_ug_L = no3)

mpr_clean <- mpr %>% 
  select(sample_id, code, sample_date, k, no3) %>% 
  mutate(sample_date = lubridate::mdy(sample_date)) %>% 
  rename(k_mg_L = k, no3_ug_L = no3)



combined_sites <- rbind(qc1_clean, qc2_clean, qc3_clean, mpr_clean) %>% 
  rename(site_id = sample_id) %>%
  mutate(year = lubridate::year(sample_date))
  
  
combined_summary <- combined_sites %>% 
  group_by(site_id, year) %>% 
  summarize(mean_k = mean(k_mg_L, na.rm = TRUE),
            mean_no3 = mean(no3_ug_L, na.rm = TRUE))
```

# Plotting the data
- Created one plot for K and another for NO3
- Created an aggregated graph using the `patchwork` package!
```{r}
k <- ggplot(data = combined_sites, aes(x = sample_date, y = k_mg_L))+
  geom_line(aes(color = site_id),
            show.legend = FALSE)+
  theme_classic()+
  theme(axis.title.x = element_blank())+
  labs(y = "K (mg/L)",
       color = "Sites",
       title = "TITLE")

n <- ggplot(data = combined_sites, aes(x = sample_date, y = no3_ug_L))+
  geom_line(aes(color = site_id)) +
  theme_classic()+
  labs(x = "Year",
       y = expression(paste(NO[3]-N, " ",(mu *g/L))),
       color = "Sites") 

k / n
```


## Summary plot

```{r}
k_summary_plot <- ggplot(data = combined_summary, aes(x = year,
                                                      y = mean_k))+
  geom_point(aes(color = site_id, shape = site_id),
            show.legend = FALSE) +
  geom_line(aes(color = site_id)) +
  theme_classic() +
  theme(axis.title.x = element_blank())+
  labs(y = "K (mg/L)",
       color = "Sites",
       title = "TITLE")

n_summary_plot <- ggplot(data = combined_summary, aes(x = year, y = mean_no3)) +
  geom_point(aes(color = site_id, shape = site_id)) +
  geom_line(aes(color = site_id)) +
  theme_classic() +
  labs(x = "Year",
       y = expression(paste(NO[3]-N, " ",(mu *g/L))),
       color = "Sites")

k_summary_plot / n_summary_plot
```


# To Do
- results/ analysis
- clean excess code/ document

